<body>
</body>
<script type="text/javascript" src="https://raw.github.com/douglascrockford/JSON-js/master/json2.js"></script>
<script type="text/javascript" src="https://raw.github.com/legu2009/cross-domain-javascript/master/CrossDomain.js"></script>
<script>
(function () {
	var host = window.location.host;
	var slice = Array.prototype.slice;
	typeof console == "undefined" && (console = {
		log: function (str) {
			alert(str);
		}
	});
	var config = {
		clientUrl: "http://localhost:9098/client.html"
	};
	var crossDomain = getCrossDomain(config);	
	crossDomain.message.set({
		params2str: function () {
			return JSON.stringify(slice.call(arguments,0));
		},
		str2params: function (str) {
			return JSON.parse(str);
		}
	});
	if (crossDomain.isClient()) {
		var clientMap = {
			'你的名字？': '顾伟',
			'你的邮箱？': '89415119@qq.com',
			'今天日期？': new Date().toString()
		}
		crossDomain.clientCommand.add('clientCall', function() {
			try {
				console.log(arguments[2].aa);
			} catch (e) {};
			var callback = arguments[arguments.length-1];
			var ary = slice.call(arguments, 0, -1);
			console.log(host+':'+ary.join(','));
			for (var i =0;i<ary.length;i++) {
				ary[i] = clientMap[ary[i]]||ary[i];
			}
			console.log(host+':'+ary);
			callback.apply(null,ary);
			
		});
		crossDomain.message.send('mainCall','client call 9099','hello2');
	}
})();
</script>